{"ast":null,"code":"var _jsxFileName = \"/Users/nguyenhuuan/Documents/GitHub/final-web-assignment/src/views/ListCitizens/AddCitizenByCSV.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from \"@mui/material/Button\";\nimport { Ethnics } from \"../../constants/citizen/citizens\";\nimport { Religions } from \"../../constants/citizen/citizens\";\nimport { LearningLevels } from \"../../constants/citizen/citizens\";\nimport { Occupations } from \"../../constants/citizen/citizens\";\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport { appendCitizen } from '../../redux/reducers/citizens/citizens.thunk';\nimport { addToast } from \"../../utils\";\nimport { loadAgenciesAsync } from '../../redux/reducers/agencies/agencies.thunk';\nimport { styled } from '@mui/material/styles';\nimport Papa from \"papaparse\";\nimport { citizen_columns_full, educational } from '../../constants/citizen/citizens';\nimport TableExtra from '../../components/Table/TableExtra';\nimport { TableRow, TableCell } from '@mui/material';\nimport { addMultiCitizens } from \"../../api/apiCitizens\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet clicked = false;\n\nconst AddCitizenByCSV = () => {\n  _s();\n\n  const {\n    currentUser\n  } = useSelector(state => state.user);\n  const village_id = currentUser.agency.id;\n  const {\n    agencies\n  } = useSelector(state => {\n    return state.agencies;\n  });\n  var subAgencies = [];\n\n  for (var i = 0; i < agencies.length; i++) {\n    subAgencies.push(agencies[i].name);\n  }\n\n  const [declarePermission, setDeclarePermission] = useState(currentUser.actually_declared_permission);\n  useEffect(() => {\n    if (agencies.length === 0) {\n      dispatch(loadAgenciesAsync());\n    }\n  }, []);\n  useEffect(() => {\n    if (currentUser.actually_declared_permission !== declarePermission) {\n      setDeclarePermission(!declarePermission);\n    }\n  }, [currentUser, declarePermission]);\n  const Input = styled('input')({\n    display: 'none'\n  });\n\n  const allIsNumber = word => {\n    for (var x = 0; x < word.length; x++) {\n      if (!/\\d/.test(word[x])) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  const mapSubAgenciesNameToID = agencyName => {\n    if (currentUser.level === \"4\") {\n      return village_id;\n    } else {\n      for (var j = 0; j < agencies.length; j++) {\n        if (agencies[j].name === agencyName) {\n          return agencies[j].id;\n        }\n      }\n    }\n  };\n\n  const mapSubAgenciesIDToName = agencyID => {\n    if (currentUser.level === \"4\") {\n      return currentUser.agency.name;\n    } else {\n      for (var i = 0; i < agencies.length; i++) {\n        if (agencies[i].id === agencyID) {\n          return agencies[i].name;\n        }\n      }\n    }\n  };\n\n  const citizenById = {\n    id: \"\",\n    id_number: \"\",\n    name: \"\",\n    dob: new Date().toLocaleDateString('en-CA'),\n    gender: \"male\",\n    ethnic: \"Kinh (Việt)\",\n    religion: \"Không\",\n    educational: \"university\",\n    declarer: \"\",\n    occupations: \"Nhà chuyên môn bậc cao (đại học trở lên)\",\n    village_id: mapSubAgenciesNameToID(subAgencies[0]),\n    home_town: \"\",\n    address_line1: \"\",\n    address_line2: \"\"\n  };\n  const [er, setError] = useState([]);\n  const [open, setOpen] = React.useState(false);\n  const [isError, setErrorState] = React.useState([]);\n  const [citizenCSVData, setDataCSV] = useState([]);\n  const styles = {\n    root: {\n      width: \"45vw\",\n      background: \"white\",\n      borderRadius: \"10px\",\n      padding: \"40px\"\n    },\n    title: {\n      fontWeight: \"bold\",\n      fontSize: \"25px\"\n    },\n    marginRight: {\n      marginRight: \"1vw\"\n    }\n  };\n\n  const formatEducational = learningLevel => {\n    if (learningLevel === \"Tiểu học\") {\n      return \"primary\";\n    } else if (learningLevel === \"Trung học cơ sở\") {\n      return \"secondary\";\n    } else if (learningLevel === \"Trung học phổ thông\") {\n      return \"high\";\n    } else if (learningLevel === \"Cao đẳng / Đại học\") {\n      return \"university\";\n    } else if (learningLevel === \"Sau đại học\") {\n      return \"master\";\n    } else if (learningLevel === \"primary\") {\n      return \"Tiểu học\";\n    } else if (learningLevel === \"secondary\") {\n      return \"Trung học cơ sở\";\n    } else if (learningLevel === \"high\") {\n      return \"Trung học phổ thông\";\n    } else if (learningLevel === \"university\") {\n      return \"Cao đẳng / Đại học\";\n    } else if (learningLevel === \"master\") {\n      return \"Sau đại học\";\n    }\n  };\n\n  const dispatch = useDispatch();\n\n  const containUpperCase = word => {\n    if (/[ÁÀÃẢẠĂẮẰẲẴẶÂẤẦẨẪẬĐÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÔỐỒỔỖỘƠỚỜỞỠỢÓÒÕỎỌƯỨỪỬỮỰÚÙỦŨỤÝỲỶỸỴA-Z]/.test(word)) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const containLowerCase = word => {\n    if (/[aàảãáạăằẳẵắặâầẩẫấậbcdđeèẻẽéẹêềểễếệfghiìỉĩíịjklmnoòỏõóọôồổỗốộơờởỡớợpqrstuùủũúụưừửữứựvwxyỳỷỹýỵz]/.test(word)) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const containSpecialCharacter = word => {\n    // except for white-space\n    for (var x = 0; x < word.length; x++) {\n      if (!containLowerCase(word[x]) && !containUpperCase(word[x]) && !/\\d/.test(word[x]) && !/\\s/.test(word[x])) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  const validateNameInput = input => {\n    const content = input;\n    const words = content.split(/\\s/);\n\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else if (content[0] === \" \") {\n      return \"Không được bắt đầu bằng khoảng trắng!\";\n    } else if (content[content.length - 1] === \" \") {\n      return \"Không được kết thúc bằng khoảng trắng!\";\n    } else if (/\\d/.test(content)) {\n      return \"Không được chứa chữ số!\";\n    } else if (containLowerCase(content[0]) || containLowerCase(words[words.length - 1][0])) {\n      return \"Viết hoa ký tự đầu tiên của mỗi từ!\";\n    } else if (content.length > 1 && containUpperCase(content.substr(1)) && words.length < 2 || words[words.length - 1].length > 1 && containUpperCase(words[words.length - 1].substr(1))) {\n      return \"Chỉ viết hoa chữ cái đầu tiên của từ!\";\n    } else if (containSpecialCharacter(content)) {\n      return \"Không được chứa ký tự đặc biệt!\";\n    } else if (content.split(/\\s/).length - 1 < 1) {\n      return \"Ít nhất 2 từ đơn!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  const validateId_numberInput = input => {\n    const content = input;\n\n    if (allIsNumber(content) === false) {\n      return \"Chỉ được chứa chữ số!\";\n    } else if (0 < content.length && content.length < 9) {\n      return \"Số CMND/CCCD phải đủ 9/12 chữ số hoặc để trống khi chưa được cấp!\";\n    } else if (9 < content.length && content.length < 12) {\n      return \"Số CCCD phải đủ 12 chữ số!\";\n    } else if (content.length > 12) {\n      return \"Không hợp lệ!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  const validateDuplicatedId_numberInput = errors => {\n    // Chưa cập nhật lí do lỗi ở state er mà chỉ cập nhật có đúng hay sai ở state isError\n    var updateErrorState = errors;\n\n    for (var i = 0; i < citizenCSVData.length - 1; i++) {\n      var current_id_number = citizenCSVData[i].id_number;\n      var isDup = false;\n\n      if (current_id_number !== \"\") {\n        if (updateErrorState[i] === false) {\n          for (var j = i + 1; j < citizenCSVData.length; j++) {\n            if (current_id_number === citizenCSVData[j].id_number) {\n              updateErrorState[j] = true;\n              isDup = true;\n            }\n          }\n\n          updateErrorState[i] = isDup;\n        }\n      }\n\n      if (isDup) {\n        addToast({\n          type: 'error',\n          title: 'Hỏng!',\n          message: `Số CMND/CCCD ${current_id_number} bị trùng lặp`,\n          duration: 5000\n        });\n      }\n    }\n\n    setErrorState(updateErrorState);\n  };\n\n  const validateDobInput = input => {\n    const content = input;\n    let temp = content.split(/[-]/);\n\n    if (temp.length === 3) {\n      let today = new Date();\n      let dob = new Date(temp[0], temp[1] - 1, temp[2]);\n\n      if (today >= dob) {\n        return \"\";\n      }\n    }\n\n    return \"Không hợp lệ\";\n  };\n\n  const validateGenderInput = input => {\n    const content = input;\n\n    if (content === \"male\" || content === \"female\") {\n      return \"\";\n    } else {\n      return \"Không hợp lệ\";\n    }\n  };\n\n  const validateEthnicInput = input => {\n    const content = input;\n\n    for (var i = 0; i < Ethnics.length; i++) {\n      if (content === Ethnics[i]) {\n        return \"\";\n      }\n    }\n\n    return \"Không hợp lệ\";\n  };\n\n  const validateReligionInput = input => {\n    const content = input;\n\n    if (content === \"\") {\n      return \"\";\n    }\n\n    for (var i = 0; i < Religions.length; i++) {\n      if (content === Religions[i]) {\n        return \"\";\n      }\n    }\n\n    return \"Không hợp lệ\";\n  };\n\n  const validateLearningLevelsInput = input => {\n    const content = input;\n\n    for (var i = 0; i < LearningLevels.length; i++) {\n      if (content === formatEducational(LearningLevels[i])) {\n        return \"\";\n      }\n    }\n\n    return \"Không hợp lệ\";\n  };\n\n  const validateOccupationsInput = input => {\n    const content = input;\n\n    for (var i = 0; i < Occupations.length; i++) {\n      if (content === Occupations[i]) {\n        return \"\";\n      }\n    }\n\n    return \"Không hợp lệ\";\n  };\n\n  const validateHomeTownInput = input => {\n    const content = input;\n\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  const validateAddress_line1Input = input => {\n    const content = input;\n\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  const validateAddress_line2Input = input => {\n    const content = input;\n\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  if (village_id.length === 8) {\n    subAgencies.push(mapSubAgenciesIDToName(village_id));\n  }\n\n  const validateVillage_IDInput = input => {\n    const content = input;\n\n    for (var i = 0; i < subAgencies.length; i++) {\n      if (content === mapSubAgenciesNameToID(subAgencies[i])) {\n        return \"\";\n      }\n    }\n\n    return \"Đã có lỗi xảy ra\";\n  };\n\n  const validateBeforeSubmit = citizen => {\n    let err = {};\n    err.name = validateNameInput(citizen.name);\n    err.id_number = validateId_numberInput(citizen.id_number);\n    err.dob = validateDobInput(citizen.dob);\n    err.gender = validateGenderInput(citizen.gender);\n    err.ethnic = validateEthnicInput(citizen.ethnic);\n    err.religion = validateReligionInput(citizen.religion);\n    err.educational = validateLearningLevelsInput(citizen.educational);\n    err.occupations = validateOccupationsInput(citizen.occupations);\n    err.village_id = validateVillage_IDInput(citizen.village_id);\n    err.home_town = validateHomeTownInput(citizen.home_town);\n    err.address_line1 = validateAddress_line1Input(citizen.address_line1);\n    err.address_line2 = validateAddress_line2Input(citizen.address_line2);\n    return err;\n  };\n\n  const handleResetInput = event => {\n    setError([]);\n    setErrorState([]);\n    setDataCSV([]);\n    setOpen(false);\n    setDataLoaded(false);\n  };\n\n  const checkError = () => {\n    var errors = [];\n\n    for (var i = 0; i < citizenCSVData.length; i++) {\n      var err = validateBeforeSubmit(citizenCSVData[i]);\n\n      if (err.name === \"\" && err.id_number === \"\" && err.dob === \"\" && err.gender === \"\" && err.ethnic === \"\" && err.religion === \"\" && err.educational === \"\" && err.occupations === \"\" && err.village_id === \"\" && err.home_town === \"\" && err.address_line1 === \"\" && err.address_line2 === \"\") {\n        errors.push(true);\n      } else {\n        errors.push(false);\n      }\n    }\n\n    console.log(\"Errors\", errors);\n    setError({ ...er,\n      err\n    });\n    validateDuplicatedId_numberInput(errors);\n  };\n\n  const parseCSV = fileCSVdata => {\n    return new Promise(resolve => {\n      Papa.parse(fileCSVdata, {\n        delimiter: \"\",\n        header: true,\n        skipEmptyLines: true,\n        complete: function (responses) {\n          resolve(responses.data);\n        }\n      });\n    });\n  };\n\n  const validateHeaderFormat = header => {\n    if (Object.keys(header).length === 12) {\n      if (header.hasOwnProperty(\"id_number\") && header.hasOwnProperty(\"name\") && header.hasOwnProperty(\"dob\") && header.hasOwnProperty(\"gender\") && header.hasOwnProperty(\"ethnic\") && header.hasOwnProperty(\"religion\") && header.hasOwnProperty(\"educational\") && header.hasOwnProperty(\"occupations\") && header.hasOwnProperty(\"village_id\") && header.hasOwnProperty(\"home_town\") && header.hasOwnProperty(\"address_line1\") && header.hasOwnProperty(address_line2)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  const handleCSVFile = event => {\n    let fileCSVdata = event.target.files[0];\n\n    (async () => {\n      try {\n        let data = await parseCSV(fileCSVdata);\n\n        if (validateHeaderFormat(data[0])) {\n          setDataCSV(data);\n        } else {\n          addToast({\n            type: 'error',\n            title: 'Hỏng!',\n            message: `File CSV sai format!`,\n            duration: 5000\n          });\n        }\n      } catch (err) {\n        console.log(\"ParseCSV error!\");\n      }\n    })();\n  };\n\n  const [dataLoaded, setDataLoaded] = React.useState(false);\n  useEffect(() => {\n    if (citizenCSVData.length !== 0 && dataLoaded === false) {\n      checkError();\n      setOpen(true);\n      setDataLoaded(true);\n    }\n  }, [dataLoaded, citizenCSVData]);\n\n  const handleClose = () => {\n    handleResetInput();\n  };\n\n  const ableToSubmit = () => {\n    for (var i = 0; i < isError.length; i++) {\n      if (isError[i] === true) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  const updateCitizensList = data => {\n    return new Promise(resolve => {\n      for (var i = 0; i < data.length; i++) {\n        dispatch(appendCitizen(data[i]));\n      }\n\n      resolve(\"Finish update citizens list\");\n    });\n  };\n\n  const handleClick = () => {\n    if (clicked) {\n      return;\n    }\n\n    clicked = true;\n\n    if (ableToSubmit()) {\n      (async () => {\n        try {\n          let res = await addMultiCitizens(citizenCSVData);\n\n          if (res.status === 200) {\n            await updateCitizensList(res.data);\n            addToast({\n              type: 'success',\n              title: 'Xong!',\n              message: `Khai báo công dân thành công.`,\n              duration: 5000\n            });\n            handleResetInput();\n          } else {\n            addToast({\n              type: 'error',\n              title: 'Hỏng!',\n              message: `Đã xảy ra lỗi khi thêm công dân.`,\n              duration: 5000\n            });\n          }\n\n          clicked = false;\n        } catch (e) {\n          clicked = false;\n\n          if (e.response && e.response.data) {\n            var errorState = [];\n\n            for (var i = 0; i < e.response.data.length; i++) {\n              if (e.response.data[i].id_number && e.response.data[i].id_number[0] === \"{'citizen width this id_number has exist'}\") {\n                /* setError({\n                  ...er,\n                  id_number: \"Số CMND/CCCD đã tồn tại!\",\n                }); */\n                addToast({\n                  type: 'error',\n                  title: 'Hỏng!',\n                  message: `Số CMND/CCCD đã tồn tại!`,\n                  duration: 5000\n                });\n                errorState[i] = true;\n              } else {\n                errorState[i] = false;\n              }\n            }\n\n            setErrorState(errorState);\n          }\n        }\n      })();\n    }\n  };\n\n  useEffect(() => {}, [isError]);\n\n  const renderData = (item, index) => {\n    return /*#__PURE__*/_jsxDEV(TableRow, {\n      hover: true,\n      role: \"checkbox\",\n      tabIndex: -1,\n      style: {\n        background: isError[index] === true ? \"red\" : \"#82DD55\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.id_number ? item.id_number : \"-\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: new Date(item.dob).toLocaleDateString('en-GB')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 503,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.gender === \"male\" ? \"Nam\" : \"Nữ\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.ethnic\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.religion ? item.religion : \"-\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: educational[item.educational]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 507,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.occupations\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 508,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: mapSubAgenciesIDToName(item.village_id)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.home_town\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.address_line1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n        children: item.address_line2\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 13\n      }, this)]\n    }, index, true, {\n      fileName: _jsxFileName,\n      lineNumber: 500,\n      columnNumber: 9\n    }, this);\n  };\n\n  if (!declarePermission) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      htmlFor: \"contained-button-file\",\n      children: [/*#__PURE__*/_jsxDEV(Input, {\n        accept: \".csv\",\n        id: \"contained-button-file\",\n        type: \"file\",\n        onChange: handleCSVFile\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        style: {\n          background: \"#2E3192\",\n          color: \"white\",\n          marginLeft: \"10px\"\n        },\n        variant: \"contained\",\n        component: \"span\",\n        children: \"Khai b\\xE1o c\\xF4ng d\\xE2n b\\u1EB1ng file CSV\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: open,\n      onClose: handleClose,\n      maxWidth: \"xl\",\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        style: styles.title,\n        children: \"Khai b\\xE1o c\\xF4ng d\\xE2n b\\u1EB1ng file CSV\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 531,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: /*#__PURE__*/_jsxDEV(TableExtra, {\n          name: \"ListCitizensTitles\",\n          columns: citizen_columns_full,\n          data: citizenCSVData,\n          renderData: renderData,\n          searchEngine: false\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 533,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 532,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          style: {\n            marginLeft: \"10px\"\n          },\n          variant: \"light\",\n          component: \"span\",\n          onClick: handleClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 542,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          style: {\n            marginLeft: \"10px\"\n          },\n          variant: \"contained\",\n          component: \"span\",\n          onClick: handleClick,\n          disabled: !ableToSubmit(),\n          children: \"Upload\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 541,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 530,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 523,\n    columnNumber: 7\n  }, this);\n};\n\n_s(AddCitizenByCSV, \"u1E0sxysZdBFpCyBYa06/2K9xk0=\", false, function () {\n  return [useSelector, useSelector, useDispatch];\n});\n\n_c = AddCitizenByCSV;\nexport default AddCitizenByCSV;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddCitizenByCSV\");","map":{"version":3,"sources":["/Users/nguyenhuuan/Documents/GitHub/final-web-assignment/src/views/ListCitizens/AddCitizenByCSV.js"],"names":["React","useEffect","useState","useSelector","useDispatch","Button","Ethnics","Religions","LearningLevels","Occupations","Dialog","DialogActions","DialogContent","DialogTitle","appendCitizen","addToast","loadAgenciesAsync","styled","Papa","citizen_columns_full","educational","TableExtra","TableRow","TableCell","addMultiCitizens","clicked","AddCitizenByCSV","currentUser","state","user","village_id","agency","id","agencies","subAgencies","i","length","push","name","declarePermission","setDeclarePermission","actually_declared_permission","dispatch","Input","display","allIsNumber","word","x","test","mapSubAgenciesNameToID","agencyName","level","j","mapSubAgenciesIDToName","agencyID","citizenById","id_number","dob","Date","toLocaleDateString","gender","ethnic","religion","declarer","occupations","home_town","address_line1","address_line2","er","setError","open","setOpen","isError","setErrorState","citizenCSVData","setDataCSV","styles","root","width","background","borderRadius","padding","title","fontWeight","fontSize","marginRight","formatEducational","learningLevel","containUpperCase","containLowerCase","containSpecialCharacter","validateNameInput","input","content","words","split","substr","validateId_numberInput","validateDuplicatedId_numberInput","errors","updateErrorState","current_id_number","isDup","type","message","duration","validateDobInput","temp","today","validateGenderInput","validateEthnicInput","validateReligionInput","validateLearningLevelsInput","validateOccupationsInput","validateHomeTownInput","validateAddress_line1Input","validateAddress_line2Input","validateVillage_IDInput","validateBeforeSubmit","citizen","err","handleResetInput","event","setDataLoaded","checkError","console","log","parseCSV","fileCSVdata","Promise","resolve","parse","delimiter","header","skipEmptyLines","complete","responses","data","validateHeaderFormat","Object","keys","hasOwnProperty","handleCSVFile","target","files","dataLoaded","handleClose","ableToSubmit","updateCitizensList","handleClick","res","status","e","response","errorState","renderData","item","index","color","marginLeft"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Button from \"@mui/material/Button\";\nimport { Ethnics } from \"../../constants/citizen/citizens\";\nimport { Religions } from \"../../constants/citizen/citizens\";\nimport { LearningLevels } from \"../../constants/citizen/citizens\";\nimport { Occupations } from \"../../constants/citizen/citizens\";\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport { appendCitizen } from '../../redux/reducers/citizens/citizens.thunk';\nimport {addToast} from \"../../utils\"\nimport { loadAgenciesAsync } from '../../redux/reducers/agencies/agencies.thunk';\nimport { styled } from '@mui/material/styles';\nimport Papa from \"papaparse\";\nimport { citizen_columns_full, educational } from '../../constants/citizen/citizens';\nimport TableExtra from '../../components/Table/TableExtra';\nimport { TableRow, TableCell } from '@mui/material';\nimport { addMultiCitizens } from \"../../api/apiCitizens\";\n\nlet clicked = false;\n\nconst AddCitizenByCSV = () => {\n  const {currentUser} = useSelector(state => state.user);\n  const village_id = currentUser.agency.id;\n  const { agencies } = useSelector(state => {\n    return state.agencies\n  });\n  var subAgencies = [];\n  for(var i = 0; i < agencies.length; i++) {\n    subAgencies.push(agencies[i].name);\n  }\n  const [declarePermission, setDeclarePermission] = useState(currentUser.actually_declared_permission);\n\n  useEffect(() => {\n    if (agencies.length === 0) {\n      dispatch(loadAgenciesAsync());\n    }\n  }, []);\n  useEffect(() => {\n    if (currentUser.actually_declared_permission !== declarePermission) {\n      setDeclarePermission(!declarePermission);\n    }\n  }, [currentUser, declarePermission]);\n\n  const Input = styled('input')({\n    display: 'none',\n  });\n  const allIsNumber = (word) => {\n    for (var x = 0; x < word.length; x++) {\n      if (!/\\d/.test(word[x])) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  const mapSubAgenciesNameToID = (agencyName) => {\n    if (currentUser.level === \"4\") {\n      return village_id;\n    } else {\n      for (var j = 0; j < agencies.length; j++) {\n        if (agencies[j].name === agencyName) {\n          return agencies[j].id;\n        }\n      }\n    }\n  }\n\n  const mapSubAgenciesIDToName = (agencyID) => {\n    if (currentUser.level === \"4\") {\n      return currentUser.agency.name;\n    } else {\n      for (var i = 0; i < agencies.length; i++) {\n        if (agencies[i].id === agencyID) {\n          return agencies[i].name;\n        }\n      }\n    }\n  }\n\n  const citizenById = {\n    id: \"\",\n    id_number: \"\",\n    name: \"\",\n    dob: new Date().toLocaleDateString('en-CA'),\n    gender: \"male\",\n    ethnic: \"Kinh (Việt)\",\n    religion: \"Không\",\n    educational: \"university\",\n    declarer: \"\",\n    occupations: \"Nhà chuyên môn bậc cao (đại học trở lên)\",\n    village_id: mapSubAgenciesNameToID(subAgencies[0]),\n    home_town: \"\",\n    address_line1: \"\",\n    address_line2: \"\",\n  };\n\n  const [er, setError] = useState([]);\n  const [open, setOpen] = React.useState(false)\n  const [isError, setErrorState] = React.useState([]);\n\n  const [citizenCSVData, setDataCSV] = useState([]);\n\n  const styles = {\n        root: {\n            width: \"45vw\",\n            background: \"white\",\n            borderRadius: \"10px\",\n            padding: \"40px\"\n        },\n        title: {\n            fontWeight: \"bold\",\n            fontSize: \"25px\",\n        },\n        marginRight: {\n          marginRight: \"1vw\"\n        },\n  }\n\n  const formatEducational = (learningLevel) => {\n    if (learningLevel === \"Tiểu học\") {\n      return \"primary\";\n    } else if (learningLevel === \"Trung học cơ sở\") {\n      return \"secondary\";\n    } else if (learningLevel === \"Trung học phổ thông\") {\n      return \"high\";\n    } else if (learningLevel === \"Cao đẳng / Đại học\") {\n      return \"university\";\n    } else if (learningLevel === \"Sau đại học\") {\n      return \"master\";\n    } else if (learningLevel === \"primary\") {\n      return \"Tiểu học\";\n    } else if (learningLevel === \"secondary\") {\n      return \"Trung học cơ sở\";\n    } else if (learningLevel === \"high\") {\n      return \"Trung học phổ thông\";\n    } else if (learningLevel === \"university\") {\n      return \"Cao đẳng / Đại học\";\n    } else if (learningLevel === \"master\") {\n      return \"Sau đại học\";\n    } \n  }\n\n  const dispatch = useDispatch()\n    \n  const containUpperCase = (word) => {\n    if (/[ÁÀÃẢẠĂẮẰẲẴẶÂẤẦẨẪẬĐÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÔỐỒỔỖỘƠỚỜỞỠỢÓÒÕỎỌƯỨỪỬỮỰÚÙỦŨỤÝỲỶỸỴA-Z]/.test(word)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n  const containLowerCase = (word) => {\n    if (/[aàảãáạăằẳẵắặâầẩẫấậbcdđeèẻẽéẹêềểễếệfghiìỉĩíịjklmnoòỏõóọôồổỗốộơờởỡớợpqrstuùủũúụưừửữứựvwxyỳỷỹýỵz]/.test(word)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n  const containSpecialCharacter = (word) => {\n    // except for white-space\n    for (var x = 0; x < word.length; x++) {\n      if (!containLowerCase(word[x]) && !containUpperCase(word[x]) && !/\\d/.test(word[x]) && !/\\s/.test(word[x])) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  const validateNameInput = (input) => {\n    const content = input;\n    const words = content.split(/\\s/);\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else if (content[0] === \" \") {\n      return \"Không được bắt đầu bằng khoảng trắng!\";\n    } else if (content[content.length - 1] === \" \") {\n      return \"Không được kết thúc bằng khoảng trắng!\";\n    } else if (/\\d/.test(content)) {\n      return \"Không được chứa chữ số!\";\n    } else if (containLowerCase(content[0]) || containLowerCase(words[words.length - 1][0])) {\n      return \"Viết hoa ký tự đầu tiên của mỗi từ!\";\n    } else if ((content.length > 1 && containUpperCase(content.substr(1)) && words.length < 2) || (words[words.length - 1].length > 1 && containUpperCase(words[words.length - 1].substr(1)))) {\n      return \"Chỉ viết hoa chữ cái đầu tiên của từ!\";\n    } else if (containSpecialCharacter(content)) {\n      return \"Không được chứa ký tự đặc biệt!\";\n    } else if (content.split(/\\s/).length - 1 < 1) {\n      return \"Ít nhất 2 từ đơn!\";\n    } else {\n      return \"\";\n    }\n  }\n\n  const validateId_numberInput = (input) => {\n    const content = input;\n    if (allIsNumber(content) === false) {\n      return \"Chỉ được chứa chữ số!\"\n    } else if (0 < content.length && content.length < 9) {\n      return \"Số CMND/CCCD phải đủ 9/12 chữ số hoặc để trống khi chưa được cấp!\";\n    } else if (9 < content.length && content.length < 12) {\n      return \"Số CCCD phải đủ 12 chữ số!\";\n    } else if (content.length > 12) {\n      return \"Không hợp lệ!\";\n    } else {\n      return \"\"\n    }\n  }\n\n  const validateDuplicatedId_numberInput = (errors) => {\n    // Chưa cập nhật lí do lỗi ở state er mà chỉ cập nhật có đúng hay sai ở state isError\n    var updateErrorState = errors;\n    for (var i = 0; i < citizenCSVData.length - 1; i++) {\n      var current_id_number = citizenCSVData[i].id_number;\n      var isDup = false;\n      if (current_id_number !== \"\") {\n        if (updateErrorState[i] === false) {\n          for (var j = i + 1; j < citizenCSVData.length; j++) {\n            if (current_id_number === citizenCSVData[j].id_number) {\n              updateErrorState[j] = true;\n              isDup = true;\n            }\n          }\n          updateErrorState[i] = isDup;\n        }\n      }\n      if (isDup) {\n        addToast({type:'error', title:'Hỏng!', message:`Số CMND/CCCD ${current_id_number} bị trùng lặp`, duration: 5000})\n      }\n    }\n    setErrorState(updateErrorState);\n  }\n\n  const validateDobInput = (input) => {\n    const content = input;\n    let temp = content.split(/[-]/)\n    if (temp.length === 3) {\n      let today = new Date();\n      let dob = new Date(temp[0], temp[1] - 1, temp[2]);\n      if (today >= dob) {\n        return \"\"\n      }\n    }\n    return \"Không hợp lệ\"\n  }\n\n  const validateGenderInput = (input) => {\n    const content = input;\n    if (content === \"male\" || content === \"female\") {\n      return \"\"\n    } else {\n      return \"Không hợp lệ\"\n    }\n  }\n\n  const validateEthnicInput = (input) => {\n    const content = input;\n    for (var i = 0; i < Ethnics.length; i++) {\n      if (content === Ethnics[i]) {\n        return \"\"\n      }\n    }\n    return \"Không hợp lệ\"\n  }\n\n  const validateReligionInput = (input) => {\n    const content = input;\n    if (content === \"\") {\n      return \"\";\n    }\n    for (var i = 0; i < Religions.length; i++) {\n      if (content === Religions[i]) {\n        return \"\"\n      }\n    }\n    return \"Không hợp lệ\"\n  }\n\n  const validateLearningLevelsInput = (input) => {\n    const content = input;\n    for (var i = 0; i < LearningLevels.length; i++) {\n      if (content === formatEducational(LearningLevels[i])) {\n        return \"\"\n      }\n    }\n    return \"Không hợp lệ\"\n  }\n\n  const validateOccupationsInput = (input) => {\n    const content = input;\n    for (var i = 0; i < Occupations.length; i++) {\n      if (content === Occupations[i]) {\n        return \"\"\n      }\n    }\n    return \"Không hợp lệ\"\n  }\n\n  const validateHomeTownInput = (input) => {\n    const content = input;\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  const validateAddress_line1Input = (input) => {\n    const content = input;\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  const validateAddress_line2Input = (input) => {\n    const content = input;\n    if (content === '') {\n      return \"Không được để trống!\";\n    } else {\n      return \"\";\n    }\n  };\n\n  if (village_id.length === 8) {\n    subAgencies.push(mapSubAgenciesIDToName(village_id));\n  }\n\n  const validateVillage_IDInput = (input) => {\n    const content = input;\n    for (var i = 0; i < subAgencies.length; i++) {\n      if (content === mapSubAgenciesNameToID(subAgencies[i])) {\n        return \"\";\n      }\n    }\n    return \"Đã có lỗi xảy ra\";\n  }\n\n  const validateBeforeSubmit = (citizen) => {\n    let err = {}\n    err.name = validateNameInput(citizen.name);\n    err.id_number = validateId_numberInput(citizen.id_number);\n    err.dob = validateDobInput(citizen.dob);\n    err.gender = validateGenderInput(citizen.gender);\n    err.ethnic = validateEthnicInput(citizen.ethnic);\n    err.religion = validateReligionInput(citizen.religion);\n    err.educational = validateLearningLevelsInput(citizen.educational);\n    err.occupations = validateOccupationsInput(citizen.occupations);\n    err.village_id = validateVillage_IDInput(citizen.village_id);\n    err.home_town = validateHomeTownInput(citizen.home_town);\n    err.address_line1 = validateAddress_line1Input(citizen.address_line1);\n    err.address_line2 = validateAddress_line2Input(citizen.address_line2);\n    return err;\n  }\n\n  const handleResetInput = (event) => {\n    setError([]);\n    setErrorState([]);\n    setDataCSV([]);\n    setOpen(false);\n    setDataLoaded(false);\n  }\n\n  const checkError = () => {\n      var errors = [];\n      for (var i = 0; i < citizenCSVData.length; i++) {\n        var err = validateBeforeSubmit(citizenCSVData[i]);\n        if (err.name === \"\" && err.id_number === \"\" && err.dob === \"\" && err.gender === \"\" && err.ethnic === \"\" && err.religion === \"\" && err.educational === \"\" && err.occupations === \"\" && err.village_id === \"\" && err.home_town === \"\" && err.address_line1 === \"\" && err.address_line2 === \"\") {\n          errors.push(true);\n        } else {\n          errors.push(false);\n        }\n      }\n      console.log(\"Errors\", errors)\n      setError({\n        ...er,\n        err\n      })\n      validateDuplicatedId_numberInput(errors);\n  }\n\n  const parseCSV = (fileCSVdata) => {\n    return new Promise((resolve) => {\n      Papa.parse(fileCSVdata, {\n        delimiter: \"\",\n        header: true,\n        skipEmptyLines: true,\n        complete: function(responses) {\n          resolve(responses.data);\n        }\n      });\n    });\n  }\n\n  const validateHeaderFormat = (header) => {\n    if (Object.keys(header).length === 12) { \n      if (header.hasOwnProperty(\"id_number\") && header.hasOwnProperty(\"name\") && header.hasOwnProperty(\"dob\") && header.hasOwnProperty(\"gender\") && header.hasOwnProperty(\"ethnic\") && header.hasOwnProperty(\"religion\") && header.hasOwnProperty(\"educational\") && header.hasOwnProperty(\"occupations\") && header.hasOwnProperty(\"village_id\") && header.hasOwnProperty(\"home_town\") && header.hasOwnProperty(\"address_line1\") && header.hasOwnProperty(address_line2)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  const handleCSVFile = (event) => {\n    let fileCSVdata = event.target.files[0];\n    (async() => {\n      try {\n        let data = await parseCSV(fileCSVdata);\n        if (validateHeaderFormat(data[0])) {\n          setDataCSV(data);\n        } else {\n          addToast({type:'error', title:'Hỏng!', message:`File CSV sai format!`, duration: 5000})\n        }\n      } catch (err) {\n        console.log(\"ParseCSV error!\");\n      }\n    })()\n  }\n\n  const [dataLoaded, setDataLoaded] = React.useState(false);\n\n  useEffect(() => {\n    if (citizenCSVData.length !== 0 && dataLoaded === false) {\n      checkError();\n      setOpen(true);\n      setDataLoaded(true);\n    }\n  }, [dataLoaded, citizenCSVData]);\n\n  const handleClose = () => {\n    handleResetInput();\n  };\n\n  const ableToSubmit = () => {\n    for (var i = 0; i < isError.length; i++) {\n      if (isError[i] === true) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  const updateCitizensList = (data) => {\n    return new Promise((resolve) => {\n      for (var i = 0; i < data.length; i++) {\n        dispatch(appendCitizen(data[i]));\n      }\n      resolve(\"Finish update citizens list\");\n    });\n  }\n\n  const handleClick = () => {\n    if (clicked) {\n      return \n    }\n    clicked = true\n    if (ableToSubmit()) {\n      (async () => {\n        try {\n          let res = await addMultiCitizens(citizenCSVData);\n          if (res.status === 200) {\n            await updateCitizensList(res.data);\n            addToast({type:'success', title:'Xong!', message:`Khai báo công dân thành công.`, duration: 5000});\n            handleResetInput();\n          } else {\n            addToast({type:'error', title:'Hỏng!', message:`Đã xảy ra lỗi khi thêm công dân.`, duration: 5000})\n          }\n          clicked = false\n        } catch (e) {\n          clicked = false\n          if (e.response && e.response.data) {\n            var errorState = [];\n            for (var i = 0; i < e.response.data.length; i++) {\n              if(e.response.data[i].id_number && e.response.data[i].id_number[0] === \"{'citizen width this id_number has exist'}\") {\n                /* setError({\n                  ...er,\n                  id_number: \"Số CMND/CCCD đã tồn tại!\",\n                }); */\n                addToast({type:'error', title:'Hỏng!', message:`Số CMND/CCCD đã tồn tại!`, duration: 5000})\n                errorState[i] = true;\n              } else {\n                errorState[i] = false;\n              }\n            }\n            setErrorState(errorState);\n          }\n        }\n      })();\n    }\n  }\n\n  useEffect(() => {\n    \n  }, [isError]);\n\n  const renderData = (item, index) => {\n    return (\n        <TableRow key={index} hover role=\"checkbox\" tabIndex={-1} style={{background: isError[index] === true ? \"red\":\"#82DD55\"}}>\n            <TableCell>{item.id_number? item.id_number: \"-\"}</TableCell>\n            <TableCell>{item.name}</TableCell>\n            <TableCell>{new Date(item.dob).toLocaleDateString('en-GB')}</TableCell>\n            <TableCell>{item.gender === \"male\" ? \"Nam\":\"Nữ\"}</TableCell>\n            <TableCell>{item.ethnic}</TableCell>\n            <TableCell>{item.religion?  item.religion: \"-\"}</TableCell>\n            <TableCell>{educational[item.educational]}</TableCell>\n            <TableCell>{item.occupations}</TableCell>\n            <TableCell>{mapSubAgenciesIDToName(item.village_id)}</TableCell>\n            <TableCell>{item.home_town}</TableCell>\n            <TableCell>{item.address_line1}</TableCell>\n            <TableCell>{item.address_line2}</TableCell>\n        </TableRow>\n    )\n}\n\n\n\n  if (!declarePermission) {\n    return null\n  }\n    return (\n      <div>\n          <label htmlFor=\"contained-button-file\">\n            <Input accept=\".csv\" id=\"contained-button-file\" type=\"file\" onChange={handleCSVFile}/>\n            <Button style={{background: \"#2E3192\", color: \"white\", marginLeft: \"10px\"}} variant=\"contained\" component=\"span\">\n                Khai báo công dân bằng file CSV\n            </Button>\n          </label>\n      <Dialog open={open} onClose={handleClose} maxWidth='xl'>\n        <DialogTitle style={styles.title}>Khai báo công dân bằng file CSV</DialogTitle>\n        <DialogContent>\n          <TableExtra\n            name=\"ListCitizensTitles\"\n            columns = {citizen_columns_full}\n            data = {citizenCSVData}\n            renderData = {renderData}\n            searchEngine = {false}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button style={{marginLeft: \"10px\"}} variant=\"light\" component=\"span\" onClick={handleClose} >\n            Hủy\n          </Button>\n          <Button style={{ marginLeft: \"10px\"}} variant=\"contained\" component=\"span\" onClick={handleClick} disabled={!ableToSubmit()}>\n            Upload\n          </Button>\n        </DialogActions>\n      </Dialog>\n      </div>\n    );\n}\n\nexport default AddCitizenByCSV;"]},"metadata":{},"sourceType":"module"}